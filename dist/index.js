!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Asyncquence=t():e.Asyncquence=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(1),a={execImmediate:!0,cancelOnError:!1,passPrevValue:!1,silent:!1},c=["STATUS_CHANGE","START","PROGRESS","COMPLETE","PAUSE","RESUME","CANCEL","ERROR"],l=function(){function e(t){s(this,e),this._config=r({},a,t),this._map=new Map,this._eventListeners=new Map,this._setupEvents(),this._setDefaults()}return o(e,[{key:"_setupEvents",value:function(){var e=this._eventListeners;c.forEach(function(t){e.set(t,[])})}},{key:"_setDefaults",value:function(){this._remaining=0,this._completed=0,this._length=0,this._isPaused=!1,this._isCancelled=!1,this._isRunning=!1}},{key:"onComplete",value:function(){return this._config.silent||console.log("Asyncquence Completed"),null}},{key:"onStart",value:function(){return this._config.silent||console.log("Starting Asyncquence"),null}},{key:"onProgress",value:function(){return this._config.silent||(console.log("--progress: "+this._calcPercent()),this._isPaused&&console.log("Asyncquence paused | Completed: "+this._completed+" :: Remaining: "+this._remaining)),null}},{key:"onPause",value:function(){return this._config.silent||console.log("Pausing after current operation completes"),null}},{key:"onResume",value:function(){return this._config.silent||console.log("Asyncquence resuming | Completed: "+this._completed+" :: Remaining: "+this._remaining),null}},{key:"onCancel",value:function(){return this._config.silent||console.log("Cancelling Asyncquence..."),null}},{key:"onError",value:function(e,t){return this._config.silent||console.log("Error in Asyncquence"),null}},{key:"addEventListener",value:function(e,t){var n=this._eventListeners.get(e)||[];this._eventListeners.set(e,[].concat(i(n),[t]))}},{key:"removeEventListener",value:function(e,t){var n=this._eventListeners.get(e)||[],s=n.indexOf(t);if(!(s<0)){var r=[].concat(i(n));r.splice(s,1),this._eventListeners.set(e,r)}}},{key:"clearEventListeners",value:function(){this._eventListeners.clear(),this._setupEvents()}},{key:"_emit",value:function(e,t){this._eventListeners.get(e).forEach(function(e){e(t)})}},{key:"_addAll",value:function(e){for(var t=[],n=e,i=Array.isArray(n),s=0,n=i?n:n["function"==typeof Symbol?Symbol.iterator:"@@iterator"]();;){var r;if(i){if(s>=n.length)break;r=n[s++]}else{if(s=n.next(),s.done)break;r=s.value}var o=r;t[t.length]=this._buildTask(o)}return t}},{key:"add",value:function(e){return"STOPPED"===this.status&&this._emit("STATUS_CHANGE","READY"),Array.isArray(e)?this._addAll(e):this._buildTask(e)}},{key:"_buildTask",value:function(e){var t=void 0,n=void 0;n=Array.isArray(e)?{method:e[0],args:e[1]}:e;var i=new u(n);return t=new Promise(function(e,t){i.setPromise(e,t)}),this._remaining++,this._length++,this.HEAD?(this.TAIL.chain(i),this.TAIL=i):(this.HEAD=this.TAIL=i,this._config.execImmediate&&this.start()),t}},{key:"start",value:function(){if(!this.HEAD)throw new Error("start() called on empty asyncquence");this._isRunning=!0,this._execute(this.HEAD),this.onStart(),this._emit("START"),this._emit("STATUS_CHANGE","RUNNING")}},{key:"_reset",value:function(){this._map.delete("HEAD"),this._map.delete("TAIL"),this._setDefaults()}},{key:"pause",value:function(){if("RUNNING"!==this.status)return void console.warn("Warning: Called pause when asyncquence wasn't running");this._emit("STATUS_CHANGE","PAUSED"),this._emit("PAUSE",this.HEAD),this._isPaused=!0,this._isRunning=!1,this.onPause()}},{key:"resume",value:function(){if("PAUSED"!==this.status)return void console.warn("Warning: Called resume when asyncquence wasn't paused");this._emit("RESUME",this.HEAD),this._isPaused=!1,this.onResume(),this.start()}},{key:"cancel",value:function(){this._emit("CANCEL"),this._emit("STATUS_CHANGE","STOPPED"),this._isCancelled=!0,this.onCancel()}},{key:"clear",value:function(){this._reset(),this.clearEventListeners()}},{key:"_progress",value:function(e){this._remaining--,this._completed++,this._emit("PROGRESS",{remaining:this._remaining,completed:this._completed,percentComplete:this._calcPercent()}),this.onProgress()}},{key:"_calcPercent",value:function(){return Math.round(this._completed/this._length*100)+"%"}},{key:"_execute",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._isCancelled?void this._reset():(this._config.passPrevValue&&e.addArg(n),new Promise(function(n,i){e.execute().then(function(i){if(t._isCancelled)return void t._reset();n(i),t._continue(e,i)}).catch(function(n){t._emit("ERROR",n),t.onError(n,e),t._config.cancelOnError?(t.cancel(),t._reset()):t._continue(e,null,n)})}))}},{key:"_continue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n?e.reject(n):e.resolve(t),this._progress(e),e.next?(this.HEAD=e.next,this._isPaused||this._execute(e.next,t)):(this._emit("COMPLETE"),this._emit("STATUS_CHANGE","STOPPED"),this._reset(),this.onComplete())}},{key:"HEAD",get:function(){return this._map.get("HEAD")},set:function(e){this._map.set("HEAD",e)}},{key:"TAIL",get:function(){return this._map.get("TAIL")},set:function(e){this._map.set("TAIL",e)}},{key:"status",get:function(){return this._isPaused?"PAUSED":!this.HEAD||this._config.execImmediate||this._isRunning?this._isRunning?"RUNNING":"STOPPED":"READY"}}]),e}();e.exports=l},function(e,t){function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(t){if(i(this,e),null==t.method)throw new Error("No method found. To add task: asq.add({method: func, args: []}), or asq.add([func, args])");this._args=[],this._method=null;for(var n in t)t.hasOwnProperty(n)&&(this["_"+n]=t[n]);this._resolve=function(){return null},this._reject=function(){return null}}return s(e,[{key:"chain",value:function(e){this._next=e}},{key:"setPromise",value:function(e,t){this._resolve=e,this._reject=t}},{key:"addArg",value:function(e){this._args=this._args?[].concat(n(this._args),[e]):[e]}},{key:"reject",value:function(e){this._reject(e)}},{key:"resolve",value:function(e){this._resolve(e)}},{key:"execute",value:function(){var e=this._method,t=this._args;return Promise.resolve(e.apply(void 0,n(t)))}},{key:"next",get:function(){return null!=this._next&&this._next}}]),e}();e.exports=r}])});